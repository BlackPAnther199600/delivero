{"ast":null,"code":"import axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nconst API_URL = __DEV__ && typeof window !== 'undefined' ? 'http://localhost:5000/api' : 'http://192.168.1.5:5000/api';\nconst apiClient = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\napiClient.interceptors.request.use(async config => {\n  try {\n    const token = await AsyncStorage.getItem('token');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n  } catch (e) {\n    console.error('Errore nel recuperare il token:', e);\n  }\n  return config;\n});\nexport const authAPI = {\n  register: async (email, password, name) => {\n    try {\n      const response = await apiClient.post('/auth/register', {\n        email,\n        password,\n        name\n      });\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || {\n        message: 'Errore nella registrazione'\n      };\n    }\n  },\n  login: async (email, password) => {\n    try {\n      const response = await apiClient.post('/auth/login', {\n        email,\n        password\n      });\n      await AsyncStorage.setItem('token', response.data.token);\n      await AsyncStorage.setItem('user', JSON.stringify(response.data.user));\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || {\n        message: 'Errore nel login'\n      };\n    }\n  },\n  logout: async () => {\n    await AsyncStorage.removeItem('token');\n    await AsyncStorage.removeItem('user');\n  }\n};\nexport const ordersAPI = {\n  getAll: async () => {\n    const res = await apiClient.get('/orders');\n    return res.data;\n  },\n  getMyOrders: async () => {\n    const res = await apiClient.get('/orders/my');\n    return res.data;\n  },\n  create: data => apiClient.post('/orders', data),\n  getAvailable: async () => {\n    const res = await apiClient.get('/orders/available');\n    return res.data;\n  },\n  trackOrder: async id => {\n    const res = await apiClient.get(`/orders/${id}/track`);\n    return res.data;\n  },\n  cancelOrder: async id => {\n    const res = await apiClient.put(`/orders/${id}/cancel`);\n    return res.data;\n  },\n  rateOrder: async (id, data) => {\n    const res = await apiClient.post(`/orders/${id}/rate`, data);\n    return res.data;\n  },\n  getActiveRiderOrders: async () => {\n    const res = await apiClient.get('/orders/rider/active');\n    return res.data;\n  },\n  acceptOrder: async id => {\n    const res = await apiClient.put(`/orders/${id}/accept`);\n    return res.data;\n  },\n  updateOrderStatus: async (id, status) => {\n    const res = await apiClient.put(`/orders/${id}/status`, {\n      status\n    });\n    return res.data;\n  },\n  completeOrder: async id => {\n    const res = await apiClient.put(`/orders/${id}/complete`);\n    return res.data;\n  },\n  completeDelivery: async id => {\n    const res = await apiClient.put(`/orders/${id}/delivered`);\n    return res.data;\n  },\n  updateRiderLocation: async (orderId, latitude, longitude, eta_minutes) => {\n    const res = await apiClient.post(`/orders/${orderId}/location`, {\n      latitude,\n      longitude,\n      eta_minutes\n    });\n    return res.data;\n  },\n  getTrackingInfo: async orderId => {\n    const res = await apiClient.get(`/orders/${orderId}/track`);\n    return res.data;\n  },\n  getTrackHistory: async orderId => {\n    const res = await apiClient.get(`/orders/${orderId}/track-history`);\n    return res.data;\n  },\n  getActiveOrdersTracking: async () => {\n    const res = await apiClient.get('/orders/active/all');\n    return res.data;\n  },\n  sendLocation: location => apiClient.post('/rider/location', location),\n  getRiderLocation: riderId => apiClient.get(`/rider/${riderId}/location`)\n};\nexport const userAPI = {\n  getProfile: () => apiClient.get('/user/profile'),\n  updateProfile: data => apiClient.put('/user/profile', data),\n  setPushToken: token => apiClient.put('/auth/push-token', {\n    push_token: token\n  })\n};\nexport default apiClient;","map":{"version":3,"names":["axios","AsyncStorage","API_URL","__DEV__","window","apiClient","create","baseURL","headers","interceptors","request","use","config","token","getItem","Authorization","e","console","error","authAPI","register","email","password","name","response","post","data","message","login","setItem","JSON","stringify","user","logout","removeItem","ordersAPI","getAll","res","get","getMyOrders","getAvailable","trackOrder","id","cancelOrder","put","rateOrder","getActiveRiderOrders","acceptOrder","updateOrderStatus","status","completeOrder","completeDelivery","updateRiderLocation","orderId","latitude","longitude","eta_minutes","getTrackingInfo","getTrackHistory","getActiveOrdersTracking","sendLocation","location","getRiderLocation","riderId","userAPI","getProfile","updateProfile","setPushToken","push_token"],"sources":["C:/Users/luca0/Desktop/delivero/mobile/services/api.js"],"sourcesContent":["import axios from 'axios';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\n// Auto-detect: use localhost for web, use LAN IP for mobile emulator/device\r\nconst API_URL = __DEV__ && typeof window !== 'undefined'\r\n  ? 'http://localhost:5000/api'\r\n  : 'http://192.168.1.5:5000/api';\r\n\r\nconst apiClient = axios.create({\r\n  baseURL: API_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json'\r\n  }\r\n});\r\n\r\n// Aggiungi token ai request\r\napiClient.interceptors.request.use(async (config) => {\r\n  try {\r\n    const token = await AsyncStorage.getItem('token');\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n  } catch (e) {\r\n    console.error('Errore nel recuperare il token:', e);\r\n  }\r\n  return config;\r\n});\r\n\r\nexport const authAPI = {\r\n  register: async (email, password, name) => {\r\n    try {\r\n      const response = await apiClient.post('/auth/register', { email, password, name });\r\n      return response.data;\r\n    } catch (error) {\r\n      throw error.response?.data || { message: 'Errore nella registrazione' };\r\n    }\r\n  },\r\n\r\n  login: async (email, password) => {\r\n    try {\r\n      const response = await apiClient.post('/auth/login', { email, password });\r\n      await AsyncStorage.setItem('token', response.data.token);\r\n      await AsyncStorage.setItem('user', JSON.stringify(response.data.user));\r\n      return response.data;\r\n    } catch (error) {\r\n      throw error.response?.data || { message: 'Errore nel login' };\r\n    }\r\n  },\r\n\r\n  logout: async () => {\r\n    await AsyncStorage.removeItem('token');\r\n    await AsyncStorage.removeItem('user');\r\n  }\r\n};\r\n\r\nexport const ordersAPI = {\r\n  // Customer endpoints\r\n  getAll: async () => {\r\n    const res = await apiClient.get('/orders');\r\n    return res.data;\r\n  },\r\n  getMyOrders: async () => {\r\n    const res = await apiClient.get('/orders/my');\r\n    return res.data;\r\n  },\r\n  create: (data) => apiClient.post('/orders', data),\r\n  getAvailable: async () => {\r\n    const res = await apiClient.get('/orders/available');\r\n    return res.data;\r\n  },\r\n  trackOrder: async (id) => {\r\n    const res = await apiClient.get(`/orders/${id}/track`);\r\n    return res.data;\r\n  },\r\n  cancelOrder: async (id) => {\r\n    const res = await apiClient.put(`/orders/${id}/cancel`);\r\n    return res.data;\r\n  },\r\n  rateOrder: async (id, data) => {\r\n    const res = await apiClient.post(`/orders/${id}/rate`, data);\r\n    return res.data;\r\n  },\r\n\r\n  // Rider endpoints\r\n  getActiveRiderOrders: async () => {\r\n    const res = await apiClient.get('/orders/rider/active');\r\n    return res.data;\r\n  },\r\n  acceptOrder: async (id) => {\r\n    const res = await apiClient.put(`/orders/${id}/accept`);\r\n    return res.data;\r\n  },\r\n  updateOrderStatus: async (id, status) => {\r\n    const res = await apiClient.put(`/orders/${id}/status`, { status });\r\n    return res.data;\r\n  },\r\n  completeOrder: async (id) => {\r\n    const res = await apiClient.put(`/orders/${id}/complete`);\r\n    return res.data;\r\n  },\r\n  completeDelivery: async (id) => {\r\n    const res = await apiClient.put(`/orders/${id}/delivered`);\r\n    return res.data;\r\n  },\r\n\r\n  // Real-time tracking (rider sends location)\r\n  updateRiderLocation: async (orderId, latitude, longitude, eta_minutes) => {\r\n    const res = await apiClient.post(`/orders/${orderId}/location`, {\r\n      latitude,\r\n      longitude,\r\n      eta_minutes\r\n    });\r\n    return res.data;\r\n  },\r\n\r\n  // Get tracking info (customer/manager views)\r\n  getTrackingInfo: async (orderId) => {\r\n    const res = await apiClient.get(`/orders/${orderId}/track`);\r\n    return res.data;\r\n  },\r\n  getTrackHistory: async (orderId) => {\r\n    const res = await apiClient.get(`/orders/${orderId}/track-history`);\r\n    return res.data;\r\n  },\r\n\r\n  // Manager: get all active orders with tracking\r\n  getActiveOrdersTracking: async () => {\r\n    const res = await apiClient.get('/orders/active/all');\r\n    return res.data;\r\n  },\r\n\r\n  // Location sharing (riders)\r\n  sendLocation: (location) => apiClient.post('/rider/location', location),\r\n  getRiderLocation: (riderId) => apiClient.get(`/rider/${riderId}/location`),\r\n};\r\n\r\nexport const userAPI = {\r\n  getProfile: () => apiClient.get('/user/profile'),\r\n  updateProfile: (data) => apiClient.put('/user/profile', data),\r\n  setPushToken: (token) => apiClient.put('/auth/push-token', { push_token: token }),\r\n};\r\n\r\nexport default apiClient;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}